<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Store Badge Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #191414;
            margin-bottom: 16px;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 32px;
            margin: 32px 0;
        }
        
        .test-card {
            background: #f8f9fa;
            padding: 32px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }
        
        .test-card.edge {
            border-color: #0078d4;
            background: #f0f8ff;
        }
        
        .test-card.non-edge {
            border-color: #ff6b35;
            background: #fff5f2;
        }
        
        .test-card h3 {
            margin: 0 0 16px 0;
            font-size: 1.3em;
        }
        
        .test-card.edge h3 {
            color: #0078d4;
        }
        
        .test-card.non-edge h3 {
            color: #ff6b35;
        }
        
        .test-description {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        
        .badge-container {
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            text-align: left;
        }
        
        .instructions.edge {
            background: #e8f5e8;
            border-left: 4px solid #0078d4;
        }
        
        .instructions.non-edge {
            background: #fff3e0;
            border-left: 4px solid #ff6b35;
        }
        
        .instructions h3 {
            margin: 0 0 12px 0;
        }
        
        .instructions.edge h3 {
            color: #0078d4;
        }
        
        .instructions.non-edge h3 {
            color: #ff6b35;
        }
        
        .browser-info {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-top: 24px;
            font-size: 0.9em;
        }
        
        .browser-detected {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .browser-detected.edge {
            background: #e3f2fd;
            color: #0078d4;
            border: 1px solid #0078d4;
        }
        
        .auto-popup-notice {
            background: #e8f5e8;
            border: 2px solid #0078d4;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            color: #0078d4;
            display: none;
        }
        
        .auto-popup-notice.show {
            display: block;
        }
        
        .countdown {
            font-size: 1.2em;
            color: #1db954;
        }
        
        .browser-detected.non-edge {
            background: #fff3e0;
            color: #ff6b35;
            border: 1px solid #ff6b35;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="page-title">Microsoft Store Badge Test</h1>
        <p id="page-description">Testing Microsoft Store badge behavior across different browsers</p>
        
        <div id="instructions" class="instructions">
            <h3 id="instructions-title">üìã Testing Instructions:</h3>
            <div id="instructions-content"></div>
        </div>
        
        <!-- Auto-popup notice for Edge users -->
        <div id="auto-popup-notice" class="auto-popup-notice">
            üöÄ Auto-popup starting in <span id="countdown" class="countdown">2</span> seconds...
        </div>
        
        <div class="test-grid">
            <!-- Test 1: Spotify -->
            <div id="test-card-1" class="test-card">
                <h3>Test 1: <span id="test-1-mode"></span></h3>
                <div id="test-1-description" class="test-description"></div>
                <div class="badge-container">
                    <ms-store-badge 
                        id="badge-1"
                        productid="9NCBCSZSJRSB" 
                        productname="Spotify Music" 
                        theme="auto"
                        animation="off"
                        cid="test-spotify">
                    </ms-store-badge>
                </div>
            </div>
            
            <!-- Test 2: Discord -->
            <div id="test-card-2" class="test-card">
                <h3>Test 2: <span id="test-2-mode"></span></h3>
                <div id="test-2-description" class="test-description"></div>
                <div class="badge-container">
                    <ms-store-badge 
                        id="badge-2"
                        productid="XPDC2RH70K22MN" 
                        productname="Discord" 
                        theme="auto"
                        animation="off"
                        cid="test-discord">
                    </ms-store-badge>
                </div>
            </div>
        </div>
        
        <div class="browser-info">
            <div id="browser-detection"></div>
        </div>
    </div>

    <!-- Microsoft Store Badge Script -->
    <script type="module" src="https://get.microsoft.com/badge/ms-store-badge.bundled.js"></script>
    
    <script>
        // Browser detection
        function detectBrowser() {
            const userAgent = navigator.userAgent.toLowerCase();
            
            if (userAgent.includes('edg/') || userAgent.includes('edge/')) {
                return {
                    name: 'Microsoft Edge',
                    isEdge: true,
                    icon: 'üî∑'
                };
            }
            if (userAgent.includes('firefox/')) {
                return {
                    name: 'Firefox',
                    isEdge: false,
                    icon: 'ü¶ä'
                };
            }
            if (userAgent.includes('chrome/') && navigator.vendor?.toLowerCase().includes('google')) {
                return {
                    name: 'Chrome',
                    isEdge: false,
                    icon: 'üåê'
                };
            }
            if (userAgent.includes('safari/') && navigator.vendor?.toLowerCase().includes('apple')) {
                return {
                    name: 'Safari',
                    isEdge: false,
                    icon: 'üß≠'
                };
            }
            if (userAgent.includes('opr/') || userAgent.includes('opera/')) {
                return {
                    name: 'Opera',
                    isEdge: false,
                    icon: 'üé≠'
                };
            }
            
            return {
                name: 'Unknown Browser',
                isEdge: false,
                icon: '‚ùì'
            };
        }
        
        // Configure page based on browser
        function configurePage() {
            const browser = detectBrowser();
            const isEdge = browser.isEdge;
            
            // Update page title and description
            if (isEdge) {
                document.getElementById('page-title').innerHTML = `üî∑ Edge Lander Test`;
                document.getElementById('page-description').textContent = 'Testing native Microsoft Store popup behavior in Edge';
            } else {
                document.getElementById('page-title').innerHTML = `${browser.icon} ${browser.name} Lander Test`;
                document.getElementById('page-description').textContent = `Testing Microsoft Store direct download behavior in ${browser.name}`;
            }
            
            // Update instructions
            const instructionsDiv = document.getElementById('instructions');
            const instructionsTitle = document.getElementById('instructions-title');
            const instructionsContent = document.getElementById('instructions-content');
            
            if (isEdge) {
                instructionsDiv.className = 'instructions edge';
                instructionsTitle.textContent = 'üî∑ Edge Popup Testing:';
                instructionsContent.innerHTML = `
                    <ol>
                        <li><strong>Auto-popup:</strong> Spotify popup will appear automatically in 2 seconds</li>
                        <li>Look for a <strong>native popup that appears over this page</strong></li>
                        <li>The popup should NOT navigate away from this page</li>
                        <li>Click the Discord badge to test manual popup behavior</li>
                        <li>Compare if both popups behave the same way</li>
                    </ol>
                `;
            } else {
                instructionsDiv.className = 'instructions non-edge';
                instructionsTitle.textContent = 'üåê Non-Edge Direct Download Testing:';
                instructionsContent.innerHTML = `
                    <ol>
                        <li>Click each official <strong>"Get it from Microsoft Store"</strong> badge below</li>
                        <li>Look for a <strong>direct download of the installer</strong></li>
                        <li>You should stay on this page (no navigation away)</li>
                        <li>Compare if both Spotify and Discord download installers the same way</li>
                    </ol>
                `;
            }
            
            // Update test cards
            const testCard1 = document.getElementById('test-card-1');
            const testCard2 = document.getElementById('test-card-2');
            const badge1 = document.getElementById('badge-1');
            const badge2 = document.getElementById('badge-2');
            
            if (isEdge) {
                // Edge configuration - popup mode
                testCard1.className = 'test-card edge';
                testCard2.className = 'test-card edge';
                
                document.getElementById('test-1-mode').textContent = 'Edge Popup Mode (Spotify)';
                document.getElementById('test-2-mode').textContent = 'Edge Popup Mode (Discord)';
                
                document.getElementById('test-1-description').textContent = 'Official Microsoft Store badge with window-mode="popup". Should show native popup over this page without navigating away. Auto-loads on page load!';
                document.getElementById('test-2-description').textContent = 'Official Microsoft Store badge with window-mode="popup" for Discord. Click to test popup behavior manually.';
                
                badge1.setAttribute('window-mode', 'popup');
                badge2.setAttribute('window-mode', 'popup');
                
                // Show auto-popup notice and start countdown
                const autoPopupNotice = document.getElementById('auto-popup-notice');
                const countdownElement = document.getElementById('countdown');
                autoPopupNotice.classList.add('show');
                
                let countdown = 2;
                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        autoPopupNotice.innerHTML = 'üéØ Auto-triggering Spotify popup now...';
                        
                        // Auto-trigger the first popup after countdown
                        setTimeout(() => {
                            console.log('Auto-triggering Spotify popup for Edge testing...');
                            badge1.click();
                            
                            // Hide notice after triggering
                            setTimeout(() => {
                                autoPopupNotice.style.display = 'none';
                            }, 2000);
                        }, 500);
                    }
                }, 1000);
            } else {
                // Non-Edge configuration - direct mode
                testCard1.className = 'test-card non-edge';
                testCard2.className = 'test-card non-edge';
                
                document.getElementById('test-1-mode').textContent = 'Non-Edge Direct Mode (Spotify)';
                document.getElementById('test-2-mode').textContent = 'Non-Edge Direct Mode (Discord)';
                
                document.getElementById('test-1-description').textContent = 'Official Microsoft Store badge with window-mode="direct". Should download portable installer and stay on this page.';
                document.getElementById('test-2-description').textContent = 'Official Microsoft Store badge with window-mode="direct" for Discord. Test if direct download works consistently.';
                
                badge1.setAttribute('window-mode', 'direct');
                badge2.setAttribute('window-mode', 'direct');
                
                // Hide auto-popup notice for non-Edge browsers
                document.getElementById('auto-popup-notice').style.display = 'none';
            }
            
            // Update browser detection display
            const browserDetection = document.getElementById('browser-detection');
            const detectionClass = isEdge ? 'edge' : 'non-edge';
            
            browserDetection.innerHTML = `
                <div class="browser-detected ${detectionClass}">
                    <span>${browser.icon}</span>
                    <span>Detected: ${browser.name}</span>
                </div>
                <p><strong>Configuration:</strong> ${isEdge ? 'Popup mode for native Store integration' : 'Direct mode for portable installer downloads'}</p>
            `;
        }
        
        // Add click tracking
        document.addEventListener('click', function(e) {
            if (e.target.closest('ms-store-badge')) {
                const badge = e.target.closest('ms-store-badge');
                const windowMode = badge.getAttribute('window-mode');
                const productName = badge.getAttribute('productname');
                
                console.log(`${productName} badge clicked with window-mode="${windowMode}"`);
                
                // Check after a delay to see if we're still on this page
                setTimeout(() => {
                    if (document.hasFocus()) {
                        console.log('Still on page - popup or download likely occurred');
                    } else {
                        console.log('Left page - probably opened Store app');
                    }
                }, 1000);
            }
        });
        
        // Initialize page when loaded
        document.addEventListener('DOMContentLoaded', configurePage);
        
        // Also run immediately in case DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', configurePage);
        } else {
            configurePage();
        }
    </script>
</body>
</html>
